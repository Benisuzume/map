#!/usr/bin/env lua

local Map = require ('map.common')
local Grimex = require ('map.tools.grimex')
local Path = require ('map.path')

local options = {
	['--version'] = Map.version
}

options ['--help'] = function ()
	io.stdout:write ([[
map imports - Load imports into the working map

Usage:
  imports [options]
  imports <configuration>

Options:
  --version    Displays the version number.
  --help       Displays this help message.
]])

	os.exit (0)
end

local map, message = Map.initialize (options)

if not map then
	io.stderr:write (message)
	os.exit (1)
end

local status, output = true

if map.settings.imports then
	status, output = Grimex.imports (map.settings.prefix,
		map.settings.output.map, map.settings.imports.directory)

	output_log_path = Path.join (
		map.settings.output.directory, 'grimex-imports.txt')
	Grimex.log (output_log_path, output)
end

if status then
	io.stdout:write ('imports: ok', '\n')
	os.exit (0)
else
	io.stderr:write ('imports: failure', '\n')
	os.exit (1)
end
